<div class="app">
    <app-sidebar></app-sidebar>
    <div id="main" class="row p-3">
        <header>
            <a class="burger-btn d-block d-xl-none" onclick="sidebar()">
                <span class="iconify" data-icon="akar-icons:three-line-horizontal" style="color: grey;"></span>
            </a>
        </header>
        <div class="page-content">
            <div class="row">
                <div class="col-lg-8 col-md-8 chart p-0">
                    <div class="card mb-3">
                        <div class="card-body">
                            <canvas class="mt-3" id="myChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-4 col-md-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                <a class="avatar avatar-lg">
                                    <img *ngIf="image != null; else noImage" [src]="image" alt="Profile Pic">
                                    <ng-template #noImage>
                                        <ng-container *ngIf="patient.gender === 'Male'">
                                            <img src="../../assets/images/faces/2.jpg" alt="Face 1">
                                        </ng-container>
                                        <ng-container *ngIf="patient.gender === 'Female'">
                                            <img src="../../assets/images/faces/5.jpg" alt="Face 1">
                                        </ng-container>
                                    </ng-template>
                                </a>
                                <br>
                                <div class="ms-3 name">
                                    <h5 class="font-bold">{{patient.fname}} {{patient.lname}}</h5>
                                    <h6 style="font-size: 0.8em;" class="text-muted mb-0"></h6>
                                </div>
                            </div>
                            <table class="profile table table-hover">
                                <tr>
                                    <th>Age</th>
                                    <td>{{patient.age}}</td>
                                </tr>
                                <tr>
                                    <th>Height</th>
                                    <td>
                                        <ng-container *ngIf="patient.height === 0; else exists">-</ng-container>
                                        <ng-template #exists>{{patient.height}}</ng-template>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Weight</th>
                                    <td>
                                        <ng-container *ngIf="patient.weight === 0; else exists">-</ng-container>
                                        <ng-template #exists>{{patient.weight}}</ng-template>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Blood Group</th>
                                    <td>{{patient.bloodGroup}}</td>
                                </tr>
                                <tr>
                                    <th>Blood Type</th>
                                    <td>{{patient.bloodType}}</td>
                                </tr>
                            </table>
                            <div (click)="openModal(patient.id)"
                                class="btn d-flex justify-content-center text-light bg-blue">
                                <span class="iconify" data-icon="bxs:edit-alt" style="color: white;"></span>Edit Profile
                            </div>
                            <div class="modal bg-opaque fade show" id="modal" *ngIf="modal">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header bg-blue">
                                            <h5 class="modal-title text-light">Update Profile</h5>
                                            <button class="btn" (click)="closeModal()"><span
                                                    class="text-light">&times;</span></button>
                                        </div>
                                        <div class="row alert alert-light-success alert-dismissible m-0 mb-3 p-2 show"
                                            role="alert" id="alert" *ngIf="isupdated">
                                            <strong class="col-11 text-success mt-2">Details Updated</strong>
                                            <button type="button" class="close col-1 text-success text-center btn"
                                                (click)="dismissAlert()">&times;</button>
                                        </div>
                                        <div class="row alert alert-light-danger alert-dismissible m-0 mb-3 p-2 show"
                                            role="alert" id="alert" *ngIf="updateFailure">
                                            <strong class="col-11 text-danger mt-2">Details could not be
                                                updated</strong>
                                            <button type="button" class="close col-1 text-danger text-center btn"
                                                (click)="dismissAlert()">&times;</button>
                                        </div>
                                        <div class="row alert alert-light-danger alert-dismissible m-0 mb-3 p-2 show"
                                            role="alert" id="alert" *ngIf="invalid">
                                            <strong class="col-11 text-danger mt-2">Invalid File Type. Only JPG, JPEG
                                                and PNG Allowed</strong>
                                            <button type="button" class="close col-1 text-danger text-center btn"
                                                (click)="dismissAlert()">&times;</button>
                                        </div>
                                        <div class="row p-3 pb-0">
                                            <div class="col-md-6">
                                                <input type="file" (change)="onFileChanged($event)">
                                            </div>
                                            <div class="col-md-6 d-flex justify-content-end">
                                                <button type="button" class="btn btn-blue" (click)="onUpload()">Upload
                                                    Image</button>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="modal-body">
                                            <form [formGroup]="updateForm" (ngSubmit)="update()" class="form">
                                                <div class="form-body">
                                                    <div class="form-group">
                                                        <label for="email">Email</label>
                                                        <input type="email" class="form-control" name="email"
                                                            formControlName="email" [(ngModel)]="patient.email">
                                                        <div class="alert alert-danger p-2"
                                                            *ngIf="(email?.touched) && (email?.invalid)">
                                                            <span *ngIf="email?.errors?.['required']">This field is
                                                                required.</span>
                                                            <span *ngIf="email?.errors?.['email']">Incorrect email
                                                                format.</span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="phone">Phone Number</label>
                                                        <input type="text" class="form-control" name="phone"
                                                            formControlName="phone" [(ngModel)]="patient.phone">
                                                        <div class="alert alert-danger p-2"
                                                            *ngIf="(phone?.touched) && (phone?.invalid)">
                                                            <span *ngIf="phone?.errors?.['required']">This
                                                                field is required.</span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="address">Address</label>
                                                        <textarea type="text" class="form-control" name="address"
                                                            formControlName="address" [(ngModel)]="patient.address">
                                                            <div class="alert alert-danger p-2"
                                                            *ngIf="(address?.touched) && (address?.invalid)">
                                                                <span *ngIf="address?.errors?.['required']">This
                                                                field is required.</span>
                                                            </div>
                                                        </textarea>
                                                    </div>
                                                </div>
                                                <div class="form-actions d-flex justify-content-end mt-4">
                                                    <button type="submit" class="btn btn-blue">Save
                                                        Changes</button>
                                                </div>
                                            </form>
                                            <hr>
                                            <h5 class="font-bold mb-4">Change Password</h5>
                                            <div class="row alert alert-light-success alert-dismissible m-0 mb-3 p-2 show"
                                                role="alert" id="alert" *ngIf="passChanged">
                                                <strong class="col-11 text-success mt-2">Password Changed</strong>
                                                <button type="button" class="close col-1 text-success text-center btn"
                                                    (click)="dismissAlert()">&times;</button>
                                            </div>
                                            <div class="row alert alert-light-danger alert-dismissible m-0 mb-3 p-2 show"
                                                role="alert" id="alert" *ngIf="changeFailed">
                                                <strong class="col-11 text-danger mt-2">Could not change
                                                    password</strong>
                                                <button type="button" class="close col-1 text-danger text-center btn"
                                                    (click)="dismissAlert()">&times;</button>
                                            </div>
                                            <form [formGroup]="changePass" (ngSubmit)="changePassword()" class="form">
                                                <div class="form-body">
                                                    <div class="form-group">
                                                        <label for="password">Old Password</label>
                                                        <input type="password" class="form-control" name="password"
                                                            formControlName="password">
                                                        <div class="alert alert-danger p-2"
                                                            *ngIf="(password?.touched) && ((password?.invalid) || isNotPassword)">
                                                            <span *ngIf="password?.errors?.['required']">This field
                                                                is required.</span>
                                                            <span *ngIf="isNotPassword">
                                                                Incorrect Password.
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="password1">New Password</label>
                                                        <input type="password" class="form-control" name="password1"
                                                            formControlName="password1">
                                                        <div class="alert alert-danger p-2"
                                                            *ngIf="(password1?.touched) && (password1?.invalid)">
                                                            <span *ngIf="password1?.errors?.['required']">This field
                                                                is required.</span>
                                                            <span *ngIf="password1?.errors?.['minlength']">
                                                                Password is too short.
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group mb-4">
                                                        <label for="password2">Confirm Password</label>
                                                        <input type="password" class="form-control" name="password2"
                                                            formControlName="password2">
                                                        <div class="alert alert-danger p-2" (change)="checkPassword()"
                                                            *ngIf="(password2?.touched) && (password2?.invalid || notEqual)">
                                                            <span *ngIf="password2?.errors?.['required']">This
                                                                field is required.</span>
                                                            <span *ngIf="notEqual">
                                                                Password must match.
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer pe-0">
                                                    <button type="button" id="close" (click)="closeModal()"
                                                        class="btn btn-light-primary">Close</button>
                                                    <button type="submit" class="btn btn-blue">Change
                                                        Password</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-12 col-lg-12 ps-0">
                    <div class="card p-4 mt-0">
                        <div class="pb-3">
                            <h3>Upcoming Appointments</h3>
                            <hr>
                        </div>
                        <ng-container *ngIf="appointments.length > 0; else notFound">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Reason</th>
                                            <th>Doctor</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <ng-container *ngFor="let appointment of appointments | slice:0:7">
                                            <tr>
                                                <td>{{appointment.date}}</td>
                                                <td>{{appointment.time}}</td>
                                                <td>{{appointment.complaint}}</td>
                                                <td>{{appointment.doctorName}}</td>
                                                <td *ngIf="appointment.status === 0">
                                                    <span class="badge badge-success">Upcoming</span>
                                                </td>
                                                <td *ngIf="appointment.status === 1"><span
                                                        class="badge badge-warning">Updated</span>
                                                </td>
                                            </tr>
                                        </ng-container>
                                    </tbody>
                                </table>
                            </div>
                        </ng-container>
                        <ng-template #notFound>
                            <div class="p-3 text-center bg-light mb-3">No Upcoming Appointment</div>
                        </ng-template>
                        <a class="justify-content-end d-flex mt-3 blue" (click)="goToAppointments()">Show full
                            list
                            >>></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>